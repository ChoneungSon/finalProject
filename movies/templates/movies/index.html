{% extends 'base.html' %}
{% load bootstrap4 %}

{% block title %}main{% endblock %}

{% block CSS %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'movies/index.css' %}" />
<link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&display=swap" rel="stylesheet">
{% endblock %}

{% block body %}
    <header class="head">
        <h1 class="text-center">Chobab's Project</h1>
        {% include '__nav.html' %}
    </header>
    <body>
        <div class="container">
            <section class="main-section">
                <h1>Recommended</h1>
                <div class="wrapper">
                    <ul class="recommend-movies">
                      {% for movie in movies %} 
                        <li class="recommend-movie">
                          <div class="recommend-movie-detail">
                            <a href="{% url 'movies:movie_detail' movie.id %}"><img src="https://image.tmdb.org/t/p/original/{{ movie.poster_path}}" alt="movie-poster"></a>
                            <div class="detail-contents">
                              <h2>{{ movie.title }}</h2>
                              <!-- <p>{{ movie.release_date }}</p> -->
                              <!-- 평점 점수를 넣는건 어떨까 -->
                              <p>{{ movie.popularity }}</p>
                            </div>
                          </div>
                        </li>
                      {% endfor %}
                    </ul>
                </div>
            </section>

            <section class="search-section">
                <form class="form-inline my-2 my-lg-0" action="{% url 'movies:search' %}">
                  <input class="form-control mr-sm-2" type="search" name="search" placeholder="What are you looking for?" aria-label="Search" style="width:400px; text-align: center;">
                  <button class="btn btn-outline-info my-2 my-sm-0">Search</button>
                </form>
            </section>

            <div class="row sub-sections">
                <section class="col-8 genres">
                    <h2>Genres</h2>
                    <div class="row">
                    
                    {% for g_movie in g_movies %}
                    <!-- 장르별로 영화 구분해서 for문 돌려야 함 -->
                      {% for genre, movies in g_movie.items %}
                      {% if movies %}
                      <div class="col-6 genre-movies">
                        <p>{{ genre }}</p>
                        
                        <div id="carouselExampleControls{{genre}}" class="carousel slide" data-ride="carousel">
                          <div class="carousel-inner">

                            {% for movie in movies %}    
                                {% if forloop.counter0 == 0%}
                                <div class="carousel-item active text-center">
                                    <a href="{% url 'movies:movie_detail' movie.id %}"><img src="https://image.tmdb.org/t/p/w500/{{ movie.backdrop_path }}" class="d-block w-100" alt="movie-sub-poster"></a>
                                    <p class="text-center text-white mt-1">{{ movie.title }}</p>
                                </div>
                                {% else %}
                                <div class="carousel-item text-center">
                                    <a href="{% url 'movies:movie_detail' movie.id %}"><img src="https://image.tmdb.org/t/p/w500/{{ movie.backdrop_path }}" class="d-block w-100" alt="movie-sub-poster"></a>
                                    <p class="text-center text-decoration-none text-white mt-1">{{ movie.title }}</p>
                                </div>
                                {% endif %}
                                {% endfor %}
                          </div>
                          <a class="carousel-control-prev" href="#carouselExampleControls{{genre}}" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                          </a>
                          <a class="carousel-control-next" href="#carouselExampleControls{{genre}}" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                          </a>
                        </div>
                        
                      </div>
                      {% endif %}
                      {% endfor %}
                    {% endfor %} 
                  </div>     
                </section>

                <section class="col-4">
                    <div class="movie-rank">
                        <h2>Movie rank</h2>
                        <ul class="list-group">
                            <li class="list-group-item active border border-info bg-info">movie ranking</li>
                            {% for s_movie in s_movies %}
                            <li class="list-group-item rank-item"><span class="rank">{{ forloop.counter }}</span><a href="{% url 'movies:movie_detail' s_movie.id %}" class="text-decoration-none text-dark">{{ s_movie.title }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="review-rank">
                        <h2>Review rank</h2>
                        <ul class="list-group">
                            <li class="list-group-item active border border-info bg-info">review ranking</li>
                            {% for like_review in like_reviews %}
                            <li class="list-group-item rank-item"><span class="rank">{{ forloop.counter }}</span><a href="{% url 'movies:review_detail' like_review.id %}" class="text-decoration-none text-dark">{{ like_review.content }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                </section>

            </div>
        </div>
    </body>
{% endblock %}